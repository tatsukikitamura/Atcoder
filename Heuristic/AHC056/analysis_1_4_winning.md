# 1_4.cppが1_3.cppより勝っているテストケースの分析

## 概要
1_4.cppが1_3.cppよりスコアが良い（小さい）テストケースは8件。これらの特徴を分析し、なぜ1_4が勝っているのかを考察する。

## 1_4が勝っているテストケース一覧

| テストケース | N  | K   | 密度    | 1_3スコア | 1_4スコア | 差 | 1_4ヒューリスティック重み |
|------------|----|-----|---------|----------|----------|-----|------------------------|
| 0012.txt   | 15 |  98 | 0.4356  | 234      | 229      | -5  | 119                    |
| 0061.txt   | 15 | 135 | 0.6000  | 296      | 293      | -3  | 4                      |
| 0005.txt   | 15 | 152 | 0.6756  | 347      | 345      | -2  | 1                      |
| 0028.txt   | 14 | 122 | 0.6224  | 278      | 276      | -2  | 2                      |
| 0051.txt   | 13 | 150 | 0.8876  | 316      | 315      | -1  | 0                      |
| 0072.txt   | 14 | 115 | 0.5867  | 248      | 247      | -1  | 5                      |
| 0079.txt   | 12 |  45 | 0.3125  | 123      | 122      | -1  | 1113                   |
| 0084.txt   | 15 |  86 | 0.3822  | 210      | 209      | -1  | 331                    |

## 密度による分類

### 中密度（0.25 <= 密度 < 0.5）: 3件
- **0012.txt**: 密度=0.4356, ヒューリスティック重み=119
- **0079.txt**: 密度=0.3125, ヒューリスティック重み=1113（最大）
- **0084.txt**: 密度=0.3822, ヒューリスティック重み=331

### 高密度（密度 >= 0.5）: 5件
- **0061.txt**: 密度=0.6000, ヒューリスティック重み=4
- **0005.txt**: 密度=0.6756, ヒューリスティック重み=1
- **0028.txt**: 密度=0.6224, ヒューリスティック重み=2
- **0051.txt**: 密度=0.8876, ヒューリスティック重み=0（最小）
- **0072.txt**: 密度=0.5867, ヒューリスティック重み=5

## なぜ1_4が勝っているのか

### 1. 中密度ケース（密度0.25-0.5）での勝利

**特徴:**
- ヒューリスティック重みが適切に機能している（119-1113）
- ターゲットへの距離情報を活用できる
- BASE_COST_SCALEが大きいことで、既存パス共有のインセンティブが強い

**勝利の理由:**
1. **ヒューリスティックの有効活用**
   - 密度が中程度のため、ロジスティック関数によりヒューリスティック重みが適切な値（100-1000程度）になる
   - ターゲットへの距離情報を考慮した経路選択が可能
   - 1_3の固定重み1より、密度に応じた調整が効いている

2. **既存パス共有の最適化**
   - BASE_COST_SCALEが100倍（1,000 → 100,000）に増加
   - 新規マスへのペナルティが大きいため、既存パスを共有するインセンティブが強い
   - 中密度ではターゲットが適度に分散しており、既存パス共有の機会が多い

3. **コストバランスの最適化**
   - 新規マス: 100,000 + ヒューリスティック(100-1000) × 距離
   - 既存マス: 0
   - この大きなコスト差により、既存パスを積極的に共有する戦略が有効

### 2. 高密度ケース（密度 >= 0.5）での勝利

**特徴:**
- ヒューリスティック重みが0-5と非常に小さい
- ターゲットへの距離情報がほとんど使えない
- しかし、BASE_COST_SCALEが大きいことで、既存パス共有が強く推奨される

**勝利の理由:**
1. **既存パス共有の最大化**
   - 高密度ではターゲットが密集しているため、既存パスを共有できる機会が多い
   - BASE_COST_SCALEが100倍に増加したことで、新規マスを避けて既存パスを共有する戦略が有効
   - 1_3では新規マスへのペナルティが小さいため、不必要な新規マスを通る可能性がある

2. **ヒューリスティックの影響が小さい**
   - 高密度ではヒューリスティック重みが0-5と非常に小さい
   - ターゲットへの距離情報が使えないが、ターゲットが密集しているため、距離情報の重要性が低い
   - むしろ、既存パスを共有することが重要

3. **コスト計算の単純化**
   - 新規マス: 100,000（ヒューリスティックの影響が小さい）
   - 既存マス: 0
   - この明確なコスト差により、既存パス共有が最優先される

### 3. 特に注目すべきケース

#### 0079.txt（密度0.3125、ヒューリスティック重み1113）
- **特徴**: 低密度に近い中密度、ヒューリスティック重みが最大
- **勝利の理由**: 
  - ターゲットが分散しているため、距離情報が重要
  - ヒューリスティック重みが大きいため、ターゲットに近い経路を選択できる
  - 1_3の固定重み1より、距離情報の影響が大きい

#### 0051.txt（密度0.8876、ヒューリスティック重み0）
- **特徴**: 非常に高密度、ヒューリスティック重みが0
- **勝利の理由**:
  - ターゲットが非常に密集しているため、距離情報は不要
  - BASE_COST_SCALEが大きいことで、既存パス共有が最優先される
  - 1_3では新規マスへのペナルティが小さいため、不必要な新規マスを通る可能性がある

## コスト計算の比較

### 新規マス1つ通過時（潜在価値マップ=5、2列通路ペナルティなし）

**中密度ケース（例: 0012.txt、密度0.4356）:**
- 1_3: 1,005（BASE: 1,000 + ヒューリスティック: 1 × 5）
- 1_4: 100,595（BASE: 100,000 + ヒューリスティック: 119 × 5）
- **差**: 99,590（約100倍）

**高密度ケース（例: 0051.txt、密度0.8876）:**
- 1_3: 1,005（BASE: 1,000 + ヒューリスティック: 1 × 5）
- 1_4: 100,000（BASE: 100,000 + ヒューリスティック: 0 × 5）
- **差**: 98,995（約100倍）

## 結論

1_4が勝っている理由は、**BASE_COST_SCALEの大幅増加により、既存パス共有のインセンティブが強くなったこと**が主因です。

### 中密度ケース（密度0.25-0.5）
- ヒューリスティック重みが適切に機能し、ターゲットへの距離情報を活用できる
- 既存パス共有のインセンティブが強いため、最適な経路選択が可能
- 1_3の固定重み1より、密度に応じた調整が効いている

### 高密度ケース（密度 >= 0.5）
- ヒューリスティック重みが0-5と非常に小さいが、ターゲットが密集しているため距離情報は不要
- BASE_COST_SCALEが大きいことで、既存パス共有が最優先される
- 1_3では新規マスへのペナルティが小さいため、不必要な新規マスを通る可能性がある

### 重要な洞察

1. **既存パス共有の重要性**
   - 1_4のBASE_COST_SCALEが100倍に増加したことで、既存パス共有のインセンティブが強くなった
   - これにより、適切な既存パス共有が可能になり、スコアが改善された

2. **密度に応じた調整の有効性**
   - 中密度ではヒューリスティック重みが適切に機能し、距離情報を活用できる
   - 高密度ではヒューリスティック重みが小さくなるが、ターゲットが密集しているため距離情報は不要

3. **コストバランスの重要性**
   - 新規マス vs 既存マスのコスト比が適切に設定されている
   - 1_4では新規マスへのペナルティが大きいため、既存パス共有が最優先される

## 1_4が負けているケースとの比較

1_4が負けているケース（高密度、密度 > 0.68）では：
- ヒューリスティック重みが0に近い
- ターゲットが密集しているが、適切な新規マス選択も必要
- BASE_COST_SCALEが大きすぎて、柔軟な経路選択ができない

1_4が勝っているケースでは：
- 中密度ではヒューリスティック重みが適切に機能
- 高密度でも、ターゲットが非常に密集しており、既存パス共有が最優先で良い結果になる

## 推奨される改善方針

1. **密度に応じたBASE_COST_SCALEの調整**
   - 高密度では既存パス共有が重要だが、適切な新規マス選択も必要
   - 密度に応じてBASE_COST_SCALEを動的に調整する

2. **ヒューリスティック重みの下限設定**
   - 高密度でも最低限の重み（例: 0.1-0.5）を保つ
   - これにより、距離情報を完全に無視せず、柔軟な経路選択が可能になる

3. **コストバランスの再設計**
   - 新規マス vs 既存マスのコスト比を適切に保つ
   - 密度に応じて動的に調整する

