# 1_4.cppでスコアが悪化した原因分析

## 概要
1_4.cppは高密度（密度 > 0.68）のテストケースで1_3.cppよりスコアが悪化している。
特に密度が0.7以上のケースで顕著に悪化。

## 悪化したテストケース一覧

| テストケース | N  | K   | 密度    | 1_4スコア | 1_3スコア | 差 |
|------------|----|-----|---------|----------|----------|-----|
| 0019.txt   | 20 | 302 | 0.7550  | 652      | 638      | +14 |
| 0042.txt   | 19 | 273 | 0.7562  | 582      | 569      | +13 |
| 0045.txt   | 15 | 154 | 0.6844  | 330      | 319      | +11 |
| 0057.txt   | 17 | 237 | 0.8201  | 489      | 479      | +10 |
| 0032.txt   | 16 | 186 | 0.7266  | 400      | 391      |  +9 |
| 0048.txt   | 13 | 125 | 0.7396  | 267      | 258      |  +9 |
| 0071.txt   | 20 | 352 | 0.8800  | 722      | 714      |  +8 |
| 0076.txt   | 13 | 121 | 0.7160  | 264      | 256      |  +8 |
| 0082.txt   | 17 | 224 | 0.7751  | 472      | 465      |  +7 |
| 0001.txt   | 13 | 152 | 0.8994  | 313      | 307      |  +6 |

## 主な原因

### 1. 密度ベースのヒューリスティック「調光」の副作用

**1_4.cppの変更点:**
- ロジスティック関数によるヒューリスティック重みの動的調整
- `W(d) = 1 / (1 + e^(20 * (d - 0.25)))`
- `DENSITY_MIDPOINT = 0.25`, `DECAY_STEEPNESS = 20.0`

**問題点:**
高密度ケース（密度 > 0.25）では、ヒューリスティック重みがほぼ0になる：
- 密度0.68以上: ヒューリスティック重み ≈ 0
- 1_3では固定値1を使用

**影響:**
- 潜在価値マップ（ターゲットからの距離）による誘導が機能しない
- 経路選択が「ターゲットに近いか」ではなく「既存パスを共有できるか」のみに依存

### 2. BASE_COST_SCALEの大幅増加

**変更点:**
- 1_3: `BASE_COST_SCALE = 1,000`
- 1_4: `BASE_COST_SCALE = 100,000` (100倍)

**問題点:**
新規マス通過時のコストが100倍に増加：
- 1_3: 新規マス1つ = 1,000 + ヒューリスティック(1 * 距離)
- 1_4: 新規マス1つ = 100,000 + ヒューリスティック(0 * 距離) = 100,000

**影響:**
- 新規マスを避けすぎる傾向
- 既存パスへの過度な依存
- 高密度ケースではターゲットが密集しているため、適切な新規マス選択が重要だが、それが阻害される

### 3. LOOP_PENALTY_WEIGHTの大幅増加

**変更点:**
- 1_3: `LOOP_PENALTY_WEIGHT = 1,500`
- 1_4: `LOOP_PENALTY_WEIGHT = 150,000` (100倍)

**問題点:**
2列通路（自由度2、ターゲットから距離5以上）のペナルティが100倍に増加

**影響:**
- 2列通路を過度に避ける
- 高密度ケースでは、2列通路が有効な経路である可能性もあるが、それが排除される

## コスト計算の比較例

### 新規マス1つ通過時（潜在価値マップ=5、2列通路ペナルティなし）

**1_3:**
```
コスト = 1,000 + 1 * 5 = 1,005
```

**1_4（密度0.75の場合）:**
```
コスト = 100,000 + 0 * 5 = 100,000
差: 98,995（約100倍）
```

### 2列通路ペナルティありの場合

**1_3:**
```
コスト = 1,000 + 1 * 5 + 1,500 = 2,505
```

**1_4（密度0.75の場合）:**
```
コスト = 100,000 + 0 * 5 + 150,000 = 250,000
差: 247,495（約100倍）
```

## 根本的な問題

1. **高密度ケースでの設計ミスマッチ**
   - 密度が高い = ターゲットが密集 = 既存パス共有の機会が多い
   - しかし、ヒューリスティック重みが0になると、ターゲットへの距離情報が使えない
   - 結果として、適切な経路選択ができなくなる

2. **コストスケールの不整合**
   - BASE_COST_SCALEを100倍に増やしたが、ヒューリスティック重みが0になると、コスト差が極端に大きくなる
   - 新規マス vs 既存マスのコスト比が1:100となり、柔軟な経路選択ができない

3. **ペナルティの過剰適用**
   - 2列通路ペナルティも100倍に増加
   - 高密度ケースでは、2列通路が有効な場合もあるが、それが排除される

## 推奨される修正方針

1. **ヒューリスティック重みの下限設定**
   - 高密度でも最低限の重み（例: 0.1-0.5）を保つ
   - または、密度に応じた線形減衰を検討

2. **BASE_COST_SCALEの調整**
   - 密度に応じて動的に調整
   - 高密度では既存パス共有が重要だが、新規マスも必要

3. **LOOP_PENALTY_WEIGHTの調整**
   - 密度に応じて動的に調整
   - 高密度では2列通路も有効な場合がある

4. **コストバランスの再設計**
   - 新規マス vs 既存マスのコスト比を適切に保つ
   - ヒューリスティックが機能しない場合でも、柔軟な経路選択が可能にする

